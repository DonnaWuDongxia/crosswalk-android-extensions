// Copyright 2014 Intel Corporation. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

// This file has been auto-generated by {{code_generator}}. DO NOT MODIFY!

package org.xwalk.extensions;

import android.util.Log;
import org.json.JSONException;
import org.json.JSONObject;

import org.xwalk.app.runtime.extension.XWalkExtensionClient;
import org.xwalk.app.runtime.extension.XWalkExtensionContextClient;

import org.xwalk.extensions.{{interface_name}}_impl;

public class {{interface_name}} extends XWalkExtensionClient {
    final private XWalkExtensionContextClient mExtensionContext;

    private static final String TAG = "{{interface_name}}";
{% for method in methods %}
    private static final String CMD_{{method.name|upper}} = "{{method.name}}";
{% endfor %}

{% for attribute in attributes if attribute.idl_type != 'EventHandler' %}
{# http://www.w3.org/TR/WebIDL/#dfn-numeric-type #}
{% if attribute.idl_type == 'float' %}
{% set type = 'double' %}
{% elif attribute.idl_type == 'double' %}
{% set type = 'double' %}
{# http://www.w3.org/TR/WebIDL/#dfn-primitive-type #}
{% elif attribute.idl_type == 'boolean' %}
{% set type = 'boolean' %}
{# http://www.w3.org/TR/WebIDL/#dfn-integer-type #}
{% elif attribute.idl_type == 'short' %}
{% set type = 'int' %}
{% elif attribute.idl_type == 'long' %}
{% set type = 'long' %}
{% elif attribute.idl_type == 'unsigned long' %}
{% set type = 'long' %}
{% elif attribute.idl_type == 'long long' %}
{% set type = 'long' %}
{% elif attribute.idl_type == 'unsigned long long' %}
{% set type = 'long' %}
{# http://heycam.github.io/webidl/#idl-types #}
{% elif attribute.idl_type == 'DOMString' %}
{% set type = 'String' %}
{% else %} {# TODO(hdq) add more types support #}
{% set type = 'String' %}
{% endif %}

    private static final String CMD_JS_SET_{{attribute.name|upper}} = "js_set_{{attribute.name}}";
    private {{type}} m_{{attribute.name}};
    void set{{attribute.name|capitalize}}({{type}} propertyValue) {
        m_{{attribute.name}} = propertyValue;
        setPropertyFromNative("{{attribute.name}}", propertyValue);
    }
    {{type}} get{{attribute.name|capitalize}}() {
        return m_{{attribute.name}};
    }
{% endfor %}

    private <T> void setPropertyFromNative(String propertyName, T propertyValue) {
        try {
            JSONObject jsonOutput = new JSONObject();
            jsonOutput.put("cmd", "set_" + propertyName);
            jsonOutput.put("data", propertyValue);
            this.broadcastMessage(jsonOutput.toString());
        } catch (JSONException e) {
            Log.e(TAG, e.toString());
        }
    }

    private final {{interface_name}}_impl mImpl;

    public {{interface_name}}(String name, String JsApiContent, XWalkExtensionContextClient context) {
        super(name, JsApiContent, context);
        mExtensionContext = context;
        mImpl = new {{interface_name}}_impl(this);
    }

    @Override
    public void onMessage(int instanceId, String message) {
        if (message.isEmpty()) return;
        try {
            JSONObject jsonInput = new JSONObject(message);
            String cmd = jsonInput.getString("cmd");
            JSONObject jsonOutput = null;
            if (false) {}
{% for method in methods %}
            else if (cmd.equals(CMD_{{method.name|upper}})) {
                jsonOutput = mImpl.on{{method.name|capitalize}}(jsonInput);
            }
{% endfor %}
{% for attribute in attributes if attribute.idl_type != 'EventHandler' %}
{# TODO(hdq) use macro or parent template to avoid code duplication #}
{# http://www.w3.org/TR/WebIDL/#dfn-numeric-type #}
{% if attribute.idl_type == 'float' %}
{% set type = 'double' %}
{% elif attribute.idl_type == 'double' %}
{% set type = 'double' %}
{# http://www.w3.org/TR/WebIDL/#dfn-primitive-type #}
{% elif attribute.idl_type == 'boolean' %}
{% set type = 'boolean' %}
{# http://www.w3.org/TR/WebIDL/#dfn-integer-type #}
{% elif attribute.idl_type == 'short' %}
{% set type = 'int' %}
{% elif attribute.idl_type == 'long' %}
{% set type = 'long' %}
{% elif attribute.idl_type == 'unsigned long' %}
{% set type = 'long' %}
{% elif attribute.idl_type == 'long long' %}
{% set type = 'long' %}
{% elif attribute.idl_type == 'unsigned long long' %}
{% set type = 'long' %}
{# http://heycam.github.io/webidl/#idl-types #}
{% elif attribute.idl_type == 'DOMString' %}
{% set type = 'String' %}
{% else %} {# TODO(hdq) add more types support #}
{% set type = 'String' %}
{% endif %}
            else if (cmd.equals(CMD_JS_SET_{{attribute.name|upper}})) {
              {% if type == double %}
                set{{attribute.name|capitalize}}(jsonInput.getDouble("data"));
              {% elif type == boolean %}
                set{{attribute.name|capitalize}}(jsonInput.getBoolean("data"));
              {% elif type == int %}
                set{{attribute.name|capitalize}}(jsonInput.getInt("data"));
              {% elif type == long %}
                set{{attribute.name|capitalize}}(jsonInput.getLong("data"));
              {% elif type == String %}
                set{{attribute.name|capitalize}}(jsonInput.getString("data"));
              {% endif %}
                return;
            }
{% endfor %}
            else {
                Log.e(TAG, "Unexpected message received: " + message);
                return;
            }
            if (!jsonOutput.has("cmd")) jsonOutput.put("cmd", cmd);
            jsonOutput.put("asyncCallId", jsonInput.getString("asyncCallId"));
            this.postMessage(instanceId, jsonOutput.toString());
        } catch (JSONException e) {
            Log.e(TAG, e.toString());
        }
    }
}
